<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Курсы ЦБ РФ</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    text-align: center;
    padding: 30px;
}
.card {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 12px;
    margin: 15px auto;
    max-width: 320px;
}
.title { opacity: 0.7; font-size: 14px; }
.value { font-size: 22px; margin-top: 5px; }
</style>
</head>

<body>

<h2>Курсы ЦБ РФ</h2>
<div id="rates">Загрузка...</div>

<script>
function formatDate(date) {
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

async function loadRates() {
    try {
        // ===== ВАЛЮТЫ =====
        const currencyResponse = await fetch("https://www.cbr-xml-daily.ru/daily_json.js");
        const currencyData = await currencyResponse.json();

        const usd = currencyData.Valute.USD.Value.toFixed(2);
        const eur = currencyData.Valute.EUR.Value.toFixed(2);
        const cny = currencyData.Valute.CNY.Value.toFixed(2);

        // ===== МЕТАЛЛЫ =====
        const today = formatDate(new Date());

        const metalUrl = `https://api.allorigins.win/raw?url=https://www.cbr.ru/scripts/xml_metall.asp?date_req1=${today}&date_req2=${today}`;

        const metalResponse = await fetch(metalUrl);
        const metalText = await metalResponse.text();

        const parser = new DOMParser();
        const xml = parser.parseFromString(metalText, "text/xml");

        const records = xml.getElementsByTagName("Record");

        let gold = "нет данных";
        let silver = "нет данных";

        for (let record of records) {
            const code = record.getAttribute("Code");
            const buyNode = record.getElementsByTagName("Buy")[0];

            if (buyNode) {
                const price = parseFloat(
                    buyNode.textContent.replace(",", ".")
                ).toFixed(2);

                if (code === "1") gold = price;      // золото
                if (code === "2") silver = price;    // серебро
            }
        }

        document.getElementById("rates").innerHTML = `
            <div class="card">
                <div class="title">USD</div>
                <div class="value">1 USD = ${usd} ₽</div>
            </div>

            <div class="card">
                <div class="title">EUR</div>
                <div class="value">1 EUR = ${eur} ₽</div>
            </div>

            <div class="card">
                <div class="title">CNY</div>
                <div class="value">1 CNY = ${cny} ₽</div>
            </div>

            <div class="card">
                <div class="title">Золото (1 г)</div>
                <div class="value">${gold} ₽</div>
            </div>

            <div class="card">
                <div class="title">Серебро (1 г)</div>
                <div class="value">${silver} ₽</div>
            </div>
        `;

    } catch (error) {
        document.getElementById("rates").innerText = "Ошибка загрузки данных";
        console.error(error);
    }
}

loadRates();
</script>

</body>
</html>
