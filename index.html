<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Курсы ЦБ РФ</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: white;
            text-align: center;
            padding: 30px;
        }

        h2 {
            margin-bottom: 20px;
        }

        .card {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            margin: 15px auto;
            max-width: 320px;
        }

        .title {
            font-size: 14px;
            opacity: 0.7;
        }

        .value {
            font-size: 22px;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<h2>Курсы ЦБ РФ</h2>
<div id="rates">Загрузка...</div>

<script>
async function loadRates() {
    try {
        // ===== ВАЛЮТЫ =====
        const currencyResponse = await fetch("https://www.cbr-xml-daily.ru/daily_json.js");
        const currencyData = await currencyResponse.json();

        const usd = currencyData.Valute.USD.Value.toFixed(2);
        const eur = currencyData.Valute.EUR.Value.toFixed(2);
        const cny = currencyData.Valute.CNY.Value.toFixed(2);

        // ===== МЕТАЛЛЫ (официальный XML ЦБ) =====
        const metalResponse = await fetch(
            "https://api.allorigins.win/raw?url=https://www.cbr.ru/scripts/xml_metall.asp"
        );
        const metalText = await metalResponse.text();
        const metalXML = new DOMParser().parseFromString(metalText, "text/xml");

        function getMetal(code) {
            const records = metalXML.getElementsByTagName("Record");
            for (let record of records) {
                if (record.getAttribute("Code") === code) {
                    const buyNode = record.getElementsByTagName("Buy")[0];
                    if (buyNode) {
                        return parseFloat(
                            buyNode.textContent.replace(",", ".")
                        ).toFixed(2);
                    }
                }
            }
            return "нет данных";
        }

        const gold = getMetal("1");   // золото
        const silver = getMetal("2"); // серебро

        document.getElementById("rates").innerHTML = `
            <div class="card">
                <div class="title">USD</div>
                <div class="value">1 USD = ${usd} ₽</div>
            </div>

            <div class="card">
                <div class="title">EUR</div>
                <div class="value">1 EUR = ${eur} ₽</div>
            </div>

            <div class="card">
                <div class="title">CNY</div>
                <div class="value">1 CNY = ${cny} ₽</div>
            </div>

            <div class="card">
                <div class="title">Золото (1 г)</div>
                <div class="value">${gold} ₽</div>
            </div>

            <div class="card">
                <div class="title">Серебро (1 г)</div>
                <div class="value">${silver} ₽</div>
            </div>
        `;

    } catch (error) {
        document.getElementById("rates").innerText = "Ошибка загрузки данных";
        console.error(error);
    }
}

loadRates();
</script>
</body>
</html>
